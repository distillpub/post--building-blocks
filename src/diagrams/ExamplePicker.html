<:Window bind:innerWidth="winWidth" bind:scrollY='scrollY'/>

<div ref:picker id="example-picker" style="--left: {{left}}px;" 
  class="{{scrollY >= 1000 ? 'three' : scrollY >= 600 ? 'two' : 'one'}}">
  
  <img src="examples/input_images/{{selected}}.png" alt="{{selected}}" class="selected" />

  {{#each examples as ex}}
    {{#if ex !== selected}}
      <img src="examples/input_images/{{ex}}.png" alt="{{ex}}" on:click="set({selected: ex})" />
    {{/if}}
  {{/each}}
</div>

<style>
  #example-picker {
    overflow: hidden;
    transition-duration: .5s;
    transition-timing-function: ease-in-out;
  }

  #example-picker img {
    width: 44px;
    cursor: pointer;
    opacity: 0.4;
    border: 3px solid #fff;
    border-radius: 7px;
  }

  #example-picker img.selected {
    opacity: 1;
    border-color: #ff6600;
  }

  #example-picker img:hover { 
    opacity: 1;
    border-color: #3497FF;
  }

  .one {
    position: absolute;
    top: 0;
    height: 525px;
    width: 50px;
    margin-left: -90px;
    transition-property: width, height;
  }

  .two {
    position: fixed;
    top: 20px;
    left: calc(var(--left) - 90px);
    height: 50px;
    width: 50px;
    transition-property: width, height, left;
  }

  .three {
    position: fixed;
    top: 20px;
    left: 20px;
    height: 50px;
    width: 50px;
    opacity: 0.5;
    transition-property: width, height, left;
  }

  .two:hover, .three:hover {
    opacity: 1;
    height: 525px;
  }
</style>

<script>
  import { setDeep } from 'svelte-extras';
  import { argmax } from 'ndarray-ops';

  export default {
    data() {
      return {
        activations: {}
      };
    },

    oncreate() {
      this.set({left: this.refs.picker.parentNode.getBoundingClientRect().left});
      const examples = require('../../static/examples').examples;
      for (const ex of examples) {
        require(`../../static/examples/act_vecs/${ex}_mixed4d.npy`)
          .load((act) => this.setDeep('activations.' + ex, act));
      }
    },

    computed: {
      examples: (activations) => Object.keys(activations),
      selected: (examples) => examples[0],
      act: (selected, activations) => activations[selected],
      max_act: (act) => act && act.get(...argmax(act)),
      left: (winWidth) => {
        const picker = document.querySelector('#example-picker');
        return picker && picker.parentNode.getBoundingClientRect().left;
      }
    },

    methods: { setDeep }
  }
</script>